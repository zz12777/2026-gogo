<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 gogo - chuchu & Eddie</title>
    <style>
        :root { 
            --chuchu-bg: #fff9e6; --chuchu-main: #f39c12; 
            --eddie-bg: #f0f7ff; --eddie-main: #4a90e2;  
            --bg: #f8f9fa; --success: #2ecc71; --warn: #ff4d4d;
        }
        body { font-family: "PingFang TC", "Microsoft JhengHei", sans-serif; background: var(--bg); margin: 0; padding: 0; color: #333; }
        
        #identity-screen { position: fixed; top:0; left:0; width:100%; height:100%; background: #222; z-index: 2000; display: flex; flex-direction: column; justify-content: center; align-items: center; color: white; }
        .id-card { padding: 30px; border-radius: 20px; cursor: pointer; text-align: center; transition: 0.3s; margin: 10px; border: 3px solid transparent; width: 150px; }
        .id-card:hover { transform: scale(1.1); border-color: white; }

        .tabs { display: flex; background: #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 100; }
        .tab { flex: 1; text-align: center; padding: 15px; cursor: pointer; font-weight: bold; border-bottom: 3px solid transparent; }
        .tab.active { border-bottom: 3px solid #333; color: #333; }

        .content-section { display: none; padding: 20px; max-width: 1100px; margin: 0 auto; animation: fadeIn 0.5s; }
        .content-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .card { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .dual-layout { display: flex; gap: 20px; flex-wrap: wrap; }
        .user-box { flex: 1; min-width: 320px; border-radius: 15px; }
        
        .box-chuchu { background-color: var(--chuchu-bg); border-top: 8px solid var(--chuchu-main); }
        .box-eddie { background-color: var(--eddie-bg); border-top: 8px solid var(--eddie-main); }

        .grid-36 { display: grid; grid-template-columns: repeat(auto-fill, minmax(90px, 1fr)); gap: 10px; margin-top: 15px; }
        .phase-btn { padding: 8px; border: 1px solid #ddd; border-radius: 8px; text-align: center; cursor: pointer; background: white; font-size: 0.8rem; }
        .phase-btn.selected { background: #333; color: white; }

        .day-row { display: flex; align-items: flex-start; gap: 10px; padding: 12px; border-bottom: 1px solid rgba(0,0,0,0.05); }
        .day-info { width: 85px; font-size: 0.85rem; color: #666; font-weight: bold; }
        .day-diary { flex: 1; border: 1px solid #ddd; border-radius: 6px; padding: 8px; height: 40px; }
        .day-value-input { width: 60px; padding: 8px; border: 1px solid #ddd; border-radius: 6px; text-align: center; }

        .progress-container { background: #eee; border-radius: 20px; height: 20px; width: 100%; margin: 10px 0; overflow: hidden; }
        .progress-bar { background: var(--success); height: 100%; width: 0%; transition: width 0.5s ease; }
        
        .header-goal { background: #333; color: white; padding: 12px; text-align: center; border-radius: 8px; margin-bottom: 15px; }
        .input-group { margin-bottom: 10px; flex: 1; }
        label { font-size: 0.9rem; font-weight: bold; display: block; margin-bottom: 5px; }
        
        .nudge-btn { background: var(--warn); color: white; border: none; padding: 8px 15px; border-radius: 20px; cursor: pointer; display: none; margin: 10px auto; font-weight: bold; }
        .readonly { pointer-events: none; opacity: 0.7; filter: grayscale(0.5); }
        .shaking { animation: shake 0.3s infinite; }
        @keyframes shake { 0%, 100% { transform: translate(0); } 25% { transform: translate(-4px); } 75% { transform: translate(4px); } }
    </style>
</head>
<body>

<div id="identity-screen">
    <h1>2026 gogo - èº«ä»½ç¢ºèª</h1>
    <div style="display:flex;">
        <div class="id-card" style="background: var(--chuchu-main)" onclick="startApp('chuchu')"><h2>chuchu ğŸ‘§</h2></div>
        <div class="id-card" style="background: var(--eddie-main)" onclick="startApp('eddie')"><h2>Eddie ğŸ‘¦</h2></div>
    </div>
</div>

<div class="tabs">
    <div class="tab active" onclick="showTab(0)">å¹´åº¦ç›®æ¨™</div>
    <div class="tab" onclick="showTab(1)">36é—œå¡è¨­å®š</div>
    <div class="tab" onclick="showTab(2)">æ¯æ—¥ç´€éŒ„</div>
</div>

<section id="tab-0" class="content-section active">
    <h2>ğŸ—“ 2026 å¹´åº¦é¡˜æ™¯æ¿</h2>
    <div class="dual-layout">
        <div class="user-box box-chuchu card" id="year-chuchu">
            <h3>chuchu å¹´åº¦ç›®æ¨™</h3>
            <textarea id="annual-A" style="width:100%; height:200px;" placeholder="è¼¸å…¥å¹´åº¦ç›®æ¨™..." onchange="syncAnnual('A')"></textarea>
        </div>
        <div class="user-box box-eddie card" id="year-eddie">
            <h3>Eddie å¹´åº¦ç›®æ¨™</h3>
            <textarea id="annual-B" style="width:100%; height:200px;" placeholder="è¼¸å…¥å¹´åº¦ç›®æ¨™..." onchange="syncAnnual('B')"></textarea>
        </div>
    </div>
</section>

<section id="tab-1" class="content-section">
    <div class="header-goal" id="phase-title-setting">è«‹é¸æ“‡ä¸€å€‹éšæ®µé€²è¡Œè¨­å®š</div>
    <div class="dual-layout">
        <div class="user-box box-chuchu card" id="panel-grid-A">
            <h3>chuchu æ­·ç¨‹ç¶²æ ¼</h3>
            <div class="grid-36" id="gridA"></div>
            <div id="configA" style="display:none; margin-top:20px;">
                <h4>éšæ®µé…ç½® (chuchu)</h4>
                <div class="input-group">
                    <label>10å¤©ç›®æ¨™å…§å®¹</label>
                    <input type="text" id="targetA" style="width:100%">
                </div>
                <div style="display:flex; gap:10px;">
                    <div class="input-group">
                        <label>å–®ä½ (å¦‚:é /æ¬¡)</label>
                        <input type="text" id="unitA">
                    </div>
                    <div class="input-group">
                        <label>ç›®æ¨™ç¸½é‡</label>
                        <input type="number" id="totalA">
                    </div>
                </div>
                <button onclick="saveAndGo()" style="width:100%; padding:10px; background:#333; color:white; border:none; border-radius:5px; cursor:pointer;">é–‹å§‹ç´€éŒ„</button>
            </div>
        </div>
        <div class="user-box box-eddie card" id="panel-grid-B">
            <h3>Eddie æ­·ç¨‹ç¶²æ ¼</h3>
            <div class="grid-36" id="gridB"></div>
            <div id="configB" style="display:none; margin-top:20px;">
                <h4>éšæ®µé…ç½® (Eddie)</h4>
                <div class="input-group">
                    <label>10å¤©ç›®æ¨™å…§å®¹</label>
                    <input type="text" id="targetB" style="width:100%">
                </div>
                <div style="display:flex; gap:10px;">
                    <div class="input-group">
                        <label>å–®ä½ (å¦‚:åˆ†é˜/æ¬¡)</label>
                        <input type="text" id="unitB">
                    </div>
                    <div class="input-group">
                        <label>ç›®æ¨™ç¸½é‡</label>
                        <input type="number" id="totalB">
                    </div>
                </div>
                <button onclick="saveAndGo()" style="width:100%; padding:10px; background:#333; color:white; border:none; border-radius:5px; cursor:pointer;">é–‹å§‹ç´€éŒ„</button>
            </div>
        </div>
    </div>
</section>

<section id="tab-2" class="content-section">
    <div id="current-info" class="header-goal">2026 gogo!</div>
    <div class="dual-layout">
        <div class="user-box box-chuchu card" id="main-chuchu">
            <h3>chuchu é€²åº¦ï¼š<span id="prog-text-A">0%</span></h3>
            <div class="progress-container"><div id="bar-A" class="progress-bar"></div></div>
            <p id="sum-text-A">ç›®å‰ç´¯ç©ï¼š0 / 0</p>
            <div id="listA"></div>
            <button id="nudge-chuchu" class="nudge-btn" onclick="sendNudge('chuchu')">âš ï¸ æ•²æ•² chuchuï¼</button>
        </div>
        <div class="user-box box-eddie card" id="main-eddie">
            <h3>Eddie é€²åº¦ï¼š<span id="prog-text-B">0%</span></h3>
            <div class="progress-container"><div id="bar-B" class="progress-bar"></div></div>
            <p id="sum-text-B">ç›®å‰ç´¯ç©ï¼š0 / 0</p>
            <div id="listB"></div>
            <button id="nudge-eddie" class="nudge-btn" onclick="sendNudge('eddie')">âš ï¸ æ•²æ•² Eddieï¼</button>
        </div>
    </div>
</section>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, doc, setDoc, onSnapshot, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyDCQ4mB8c0V57ymosTIg7ihdx7IUZMT4_M",
        authDomain: "gogo-b906a.firebaseapp.com",
        projectId: "gogo-b906a",
        storageBucket: "gogo-b906a.firebasestorage.app",
        messagingSenderId: "206143011059",
        appId: "1:206143011059:web:d347c6f4da8c3498cd5f86"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    let me = "";
    let selectedPhase = 1;
    const startDate = new Date("2026-01-17");

    const goalExamples = [
        { title: "é–±è®€æ›¸ç±", unit: "é ", total: 300 },
        { title: "é–‹è»Šç·´ç¿’", unit: "è¶Ÿ", total: 3 },
        { title: "é¨è»Šå‡ºé–€", unit: "è¶Ÿ", total: 3 },
        { title: "å­¸ä»€éº¼èª²", unit: "é›†", total: 3 },
        { title: "èƒŒå–®å­—", unit: "å€‹", total: 20 },
        { title: "ç·´è‹±æ–‡", unit: "åˆ†é˜", total: 100 }
    ];

    window.startApp = (user) => {
        me = user;
        document.getElementById('identity-screen').style.display = 'none';
        initGrids();
        applyPermissions();
        listenToCloud();
        renderDaily('A'); renderDaily('B');
    };

    function applyPermissions() {
        const isC = (me === 'chuchu');
        document.getElementById('annual-A').disabled = !isC;
        document.getElementById('annual-B').disabled = isC;
        document.getElementById('listA').classList.toggle('readonly', !isC);
        document.getElementById('listB').classList.toggle('readonly', isC);
        document.getElementById('nudge-eddie').style.display = isC ? "block" : "none";
        document.getElementById('nudge-chuchu').style.display = isC ? "none" : "block";
    }

    function initGrids() {
        ['gridA', 'gridB'].forEach(id => {
            const container = document.getElementById(id);
            container.innerHTML = "";
            for (let i = 1; i <= 36; i++) {
                const btn = document.createElement('div');
                btn.className = 'phase-btn';
                let d1 = new Date(startDate); d1.setDate(startDate.getDate() + (i-1)*10);
                let d10 = new Date(d1); d10.setDate(d1.getDate() + 9);
                btn.innerHTML = `<b>P${i}</b><br><small>${d1.getMonth()+1}/${d1.getDate()}~${d10.getMonth()+1}/${d10.getDate()}</small>`;
                btn.onclick = () => {
                    selectedPhase = i;
                    document.querySelectorAll('.phase-btn').forEach(b => b.classList.remove('selected'));
                    btn.classList.add('selected');
                    document.getElementById('phase-title-setting').innerText = `æ­£åœ¨è¨­å®šï¼šç¬¬ ${i} éšæ®µ`;
                    const prefix = (id === 'gridA') ? 'A' : 'B';
                    if((prefix==='A' && me==='chuchu') || (prefix==='B' && me==='eddie')) {
                        document.getElementById('config' + prefix).style.display = 'block';
                        const ex = goalExamples[Math.floor(Math.random() * goalExamples.length)];
                        document.getElementById('target'+prefix).placeholder = "ç¯„ä¾‹ï¼š" + ex.title;
                        document.getElementById('unit'+prefix).placeholder = ex.unit;
                        document.getElementById('total'+prefix).placeholder = ex.total;
                    }
                };
                container.appendChild(btn);
            }
        });
    }

    window.saveAndGo = () => {
        const prefix = me === 'chuchu' ? 'A' : 'B';
        const tIn = document.getElementById('target'+prefix);
        const uIn = document.getElementById('unit'+prefix);
        const lIn = document.getElementById('total'+prefix);
        const target = tIn.value || tIn.placeholder.replace("ç¯„ä¾‹ï¼š", "");
        const unit = uIn.value || uIn.placeholder;
        const total = lIn.value || lIn.placeholder;
        document.getElementById('current-info').innerText = `ç¬¬ ${selectedPhase} éšæ®µ - ç•¶å‰ç›®æ¨™: ${target}`;
        renderDaily(prefix, unit, total);
        showTab(2);
    };

    window.renderDaily = (prefix, unit = "å€¼", total = 0) => {
        const container = document.getElementById('list' + prefix);
        container.innerHTML = "";
        let phaseStart = new Date(startDate); phaseStart.setDate(startDate.getDate() + (selectedPhase - 1) * 10);
        for (let d = 0; d < 10; d++) {
            let dDate = new Date(phaseStart); dDate.setDate(phaseStart.getDate() + d);
            const dateStr = `${dDate.getMonth()+1}/${dDate.getDate()} (${["æ—¥","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­"][dDate.getDay()]})`;
            container.innerHTML += `<div class="day-row"><div class="day-info">Day ${d+1}<br>${dateStr}</div><textarea class="day-diary" placeholder="å¯«æ—¥è¨˜..."></textarea><input type="number" class="day-value-input" placeholder="0" oninput="updateProgressUI('${prefix}', ${total})"><span style="font-size:0.7rem; align-self:center;">${unit}</span></div>`;
        }
        updateProgressUI(prefix, total);
    };

    window.updateProgressUI = (prefix, total) => {
        const inputs = document.querySelectorAll(`#list${prefix} .day-value-input`);
        let sum = 0; inputs.forEach(i => sum += Number(i.value || 0));
        const percent = total > 0 ? Math.min(Math.round((sum / total) * 100), 100) : 0;
        document.getElementById(`bar-${prefix}`).style.width = percent + "%";
        document.getElementById(`prog-text-${prefix}`).innerText = percent + "%";
        document.getElementById(`sum-text-${prefix}`).innerText = `ç›®å‰ç´¯ç©ï¼š${sum} / ${total}`;
    };

    // Firebase é€£å‹•
    async function listenToCloud() {
        onSnapshot(doc(db, "gogo", "data"), (docSnap) => {
            if (!docSnap.exists()) return;
            const data = docSnap.data();
            if(data.annualA) document.getElementById('annual-A').value = data.annualA;
            if(data.annualB) document.getElementById('annual-B').value = data.annualB;
            if(data.nudgeTarget === me) {
                const panel = document.getElementById('main-' + me);
                panel.classList.add('shaking');
                setTimeout(() => panel.classList.remove('shaking'), 3000);
                updateDoc(doc(db, "gogo", "data"), { nudgeTarget: null });
            }
        });
    }

    window.syncAnnual = async (p) => {
        const val = document.getElementById(`annual-${p}`).value;
        await setDoc(doc(db, "gogo", "data"), { [`annual${p}`]: val }, { merge: true });
    };

    window.sendNudge = async (target) => {
        await updateDoc(doc(db, "gogo", "data"), { nudgeTarget: target });
        alert("å·²ç™¼é€æé†’ï¼");
    };

    window.showTab = (i) => {
        document.querySelectorAll('.tab').forEach((t, idx) => t.classList.toggle('active', idx === i));
        document.querySelectorAll('.content-section').forEach((s, idx) => s.classList.toggle('active', idx === i));
    };
</script>
</body>
</html>